# Language setting
language: node_js

# Version number
node_js:
  - 7.4.0

addons:
  firefox: 54.0.1

# The path for Xunit to output test reports
env:
  global:
    - TEST_RESULTS_DIR=$SHIPPABLE_REPO_DIR/shippable/testresults
    - CODE_COVERAGE_DIR=$SHIPPABLE_REPO_DIR/shippable/codecoverage
    - MODULES_DIR=$SHIPPABLE_REPO_DIR/node_modules/.bin/
    - TESTS_DIR=$SHIPPABLE_REPO_DIR/test
    - SOURCES_DIR=$SHIPPABLE_REPO_DIR/webextension

# Branches to build
branches:
  only:
    - PasswordGenerationInterface

# Create directories for test and coverage reports
before_script:
  - mkdir -p $TEST_RESULTS_DIR && mkdir -p $CODE_COVERAGE_DIR
  - npm install -g karma

# Running the tests with mochaJS
script:
  #use xvfb (X Virtual Framebuffer) to imitate a display
  - "export DISPLAY=:99.0"
  #run tests
  - xvfb-run --server-args="-ac" npm test

# Tell istanbul to generate a coverage report
after_script:
  - xvfb-run --server-args="-ac" npm run coverage

integrations:
  notifications:
    - integrationName: email
      type: email
      recipients:
        - fffjjj@gmx.de
      on_failure: always